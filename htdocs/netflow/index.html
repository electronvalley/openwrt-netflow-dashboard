<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>OpenWrt NetFlow Dashboard</title>
<style>
:root{--bg:#080c18;--panel:rgba(10,14,30,.88);--card:rgba(20,30,50,.6);--border:rgba(255,255,255,.06);--green:#2ecc71;--blue:#3498db;--orange:#f39c12;--red:#e74c3c;--purple:#9b59b6;--cyan:#00d2d3;--text:#c8d6e5;--muted:#576574}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:"Segoe UI",system-ui,-apple-system,sans-serif;overflow:hidden;height:100vh}
#app{display:none;grid-template-columns:260px 1fr 270px;grid-template-rows:58px 1fr 175px;height:100vh}
#hdr{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;padding:0 24px;background:linear-gradient(180deg,rgba(10,14,30,.98),rgba(10,14,30,.85));border-bottom:1px solid rgba(46,204,113,.12);backdrop-filter:blur(10px)}
#hdr h1{font-size:15px;font-weight:600;color:#fff;display:flex;align-items:center;gap:10px}
.dot{width:9px;height:9px;border-radius:50%;background:var(--green);box-shadow:0 0 12px var(--green),0 0 4px var(--green);animation:glow 2s ease-in-out infinite}
.hs{display:flex;gap:28px;align-items:center}.hi{text-align:center;position:relative}.hi .v{font-size:18px;font-weight:700;color:var(--green);letter-spacing:-0.5px}.hi .l{font-size:7px;text-transform:uppercase;letter-spacing:2px;color:var(--muted);margin-top:2px}.hi::after{content:"";position:absolute;right:-14px;top:50%;transform:translateY(-50%);width:1px;height:24px;background:rgba(255,255,255,.06)}.hi:last-child::after{display:none}
#lp{background:var(--panel);border-right:1px solid rgba(46,204,113,.08);padding:16px;overflow-y:auto}#lp h2{font-size:10px;text-transform:uppercase;letter-spacing:2.5px;color:var(--green);margin-bottom:14px}
.ic{background:var(--card);border:1px solid rgba(46,204,113,.1);border-radius:8px;padding:10px 12px;margin-bottom:7px;transition:all .3s;position:relative;overflow:hidden}.ic::before{content:"";position:absolute;top:0;left:0;width:3px;height:100%;background:var(--green);opacity:.6;border-radius:0 2px 2px 0}.ic:hover{border-color:rgba(46,204,113,.35);transform:translateX(2px)}.ic.dn{opacity:.35}.ic.dn::before{background:var(--red)}
.icn{font-size:11px;font-weight:600;color:#fff;display:flex;align-items:center;gap:7px;padding-left:6px}.sd{width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green)}.sd.off{background:var(--red);box-shadow:0 0 6px var(--red)}
.ist{display:flex;justify-content:space-between;margin-top:5px;font-size:9px;padding-left:6px}.ist .rx{color:var(--blue)}.ist .tx{color:var(--orange)}.irt{font-size:10px;color:var(--green);margin-top:3px;font-weight:600;padding-left:6px}
.ib{height:3px;background:rgba(255,255,255,.03);border-radius:2px;margin-top:4px;overflow:hidden}.ibf{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--green),var(--cyan));transition:width .8s}
#cp{position:relative;overflow:hidden;background:radial-gradient(ellipse at center,rgba(46,204,113,.02) 0%,transparent 70%)}#fc{display:block;width:100%;height:100%}
#rp{background:var(--panel);border-left:1px solid rgba(155,89,182,.1);padding:16px;overflow-y:auto}#rp h2{font-size:10px;text-transform:uppercase;letter-spacing:2.5px;color:var(--purple);margin-bottom:14px}
.dc{background:var(--card);border:1px solid rgba(155,89,182,.1);border-radius:8px;padding:8px 10px;margin-bottom:5px;transition:all .3s;position:relative}.dc:hover{border-color:rgba(155,89,182,.35)}.dc.ac{border-left:3px solid var(--purple)}.dc.ac::after{content:"";position:absolute;top:4px;right:6px;width:5px;height:5px;border-radius:50%;background:var(--purple);box-shadow:0 0 6px var(--purple);animation:glow 1.5s ease-in-out infinite}
.dv{font-size:10px;font-weight:600;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.dp{font-size:8px;color:var(--muted);margin-top:1px;font-family:monospace}.dd{display:flex;gap:10px;margin-top:3px;font-size:9px}.dco{color:var(--purple);font-weight:600}
#bp{grid-column:1/-1;display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:10px 20px;background:linear-gradient(0deg,rgba(10,14,30,.95),rgba(10,14,30,.88));border-top:1px solid var(--border)}
.sb{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px 14px;position:relative;overflow:hidden}.sb::after{content:"";position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(46,204,113,.2),transparent)}.sb h3{font-size:7px;text-transform:uppercase;letter-spacing:2.5px;color:var(--muted);margin-bottom:6px}
.sv{font-size:22px;font-weight:700;line-height:1}.ss{font-size:8px;color:var(--muted);margin-top:2px}.bar{display:flex;gap:1px;height:28px;align-items:flex-end;margin-top:4px}.bi{flex:1;border-radius:2px 2px 0 0;min-height:1px;transition:height .4s}
#lo{position:fixed;inset:0;background:radial-gradient(ellipse at center,rgba(10,18,40,.98),rgba(6,8,18,.99));z-index:100;display:flex;align-items:center;justify-content:center}#lo.hid{display:none}
#lb{background:rgba(15,25,50,.9);border:1px solid rgba(46,204,113,.15);border-radius:16px;padding:40px;width:360px;text-align:center;backdrop-filter:blur(20px);box-shadow:0 25px 60px rgba(0,0,0,.5)}
#lb h2{color:#fff;font-size:20px;margin-bottom:4px;font-weight:700}#lb .sub{color:var(--muted);font-size:11px;margin-bottom:24px}
#lb input{width:100%;padding:12px 14px;margin-bottom:10px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:8px;color:#fff;font-size:12px;outline:none;transition:border-color .3s}#lb input:focus{border-color:rgba(46,204,113,.5);box-shadow:0 0 15px rgba(46,204,113,.08)}
#lb button{width:100%;padding:13px;background:linear-gradient(135deg,var(--green),#27ae60);border:none;border-radius:8px;color:#fff;font-weight:700;font-size:14px;cursor:pointer;transition:all .3s;letter-spacing:.5px}#lb button:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(46,204,113,.3)}
#le{color:var(--red);font-size:10px;margin-top:8px;display:none}
.cg{color:var(--green)}.cb{color:var(--blue)}.co{color:var(--orange)}.cr{color:var(--red)}.cp{color:var(--purple)}.cc{color:var(--cyan)}
::-webkit-scrollbar{width:3px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.06);border-radius:2px}
@keyframes glow{0%,100%{opacity:1}50%{opacity:.35}}
</style>
</head>
<body>
<div id="lo"><div id="lb"><h2>&#127760; NetFlow Dashboard</h2><div class="sub">Monitoring reseau temps reel pour OpenWrt</div><input id="lh" value="192.168.10.1" placeholder="Adresse routeur"><input id="lu" value="root" placeholder="Utilisateur"><input type="password" id="lpw" placeholder="Mot de passe" autofocus><button onclick="doLogin()">Connexion</button><div id="le">Echec d'authentification</div></div></div>
<div id="app"><div id="hdr"><h1><span class="dot"></span>NetFlow Dashboard</h1><div class="hs"><div class="hi"><div class="v" id="hR">--</div><div class="l">Download</div></div><div class="hi"><div class="v co" id="hT">--</div><div class="l">Upload</div></div><div class="hi"><div class="v cc" id="hC">--</div><div class="l">Connexions</div></div><div class="hi"><div class="v cp" id="hD">--</div><div class="l">Appareils</div></div><div class="hi"><div class="v co" id="hU">--</div><div class="l">Uptime</div></div></div></div>
<div id="lp"><h2>&#9889; Interfaces</h2><div id="iL"></div></div>
<div id="cp"><canvas id="fc"></canvas></div>
<div id="rp"><h2>&#128241; Appareils connectes</h2><div id="dL"></div></div>
<div id="bp"><div class="sb"><h3>&#128274; Protocoles</h3><div id="bP"></div></div><div class="sb"><h3>&#127760; Types de trafic</h3><div id="bT"></div></div><div class="sb"><h3>&#128187; Systeme</h3><div id="bS"></div></div><div class="sb"><h3>&#9889; Debit WAN</h3><div id="bW"></div><div class="bar" id="bB"></div></div></div></div>
<script>
var C={h:"",u:"",t:null},S={if:{},ct:[],sy:null,hi:{},dh:[],pR:{},pT:{},ra:{},pTi:0,wH:[]},fc,cx,pa=[],fr=0;
function doLogin(){C.h=document.getElementById("lh").value;C.u=document.getElementById("lu").value;var pw=document.getElementById("lpw").value;fetch("http://"+C.h+"/ubus/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"call",params:["00000000000000000000000000000000","session","login",{username:C.u,password:pw}]})}).then(function(r){return r.json()}).then(function(j){if(j.result&&j.result[0]===0){C.t=j.result[1].ubus_rpc_session;document.getElementById("lo").classList.add("hid");document.getElementById("app").style.display="grid";init()}else{document.getElementById("le").style.display="block"}}).catch(function(){document.getElementById("le").style.display="block"})}
document.getElementById("lpw").addEventListener("keydown",function(e){if(e.key==="Enter")doLogin()});
function ub(o,m,p){return fetch("http://"+C.h+"/ubus/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"call",params:[C.t,o,m,p||{}]})}).then(function(r){return r.json()}).then(function(j){return(j.result&&j.result[0]===0)?j.result[1]:null}).catch(function(){return null})}
function fA(){Promise.all([ub("luci-rpc","getNetworkDevices"),ub("system","info"),ub("luci-rpc","getDHCPLeases"),ub("luci-rpc","getHostHints"),ub("luci","getConntrackList")]).then(function(r){var nd=r[0],si=r[1],dh=r[2],hh=r[3],ct=r[4],now=Date.now();if(nd){for(var n in nd){if(n==="lo")continue;var rx=(nd[n].stats||{}).rx_bytes||0,tx=(nd[n].stats||{}).tx_bytes||0;if(S.pR[n]!==undefined&&S.pTi){var dt=(now-S.pTi)/1000;if(dt>0)S.ra[n]={r:Math.max(0,(rx-S.pR[n])/dt),t:Math.max(0,(tx-S.pT[n])/dt)}}S.pR[n]=rx;S.pT[n]=tx}S.pTi=now;S.if=nd}if(si)S.sy=si;if(dh)S.dh=dh.dhcp_leases||[];if(hh)S.hi=hh;if(ct)S.ct=ct;var w=S.ra["wan"];if(w){S.wH.push({r:w.r,t:w.t});if(S.wH.length>60)S.wH.shift()}uUI()})}
function fB(b){if(!b||b===0)return"0 B";var k=1024,s=["B","KB","MB","GB","TB"],i=Math.floor(Math.log(Math.abs(b))/Math.log(k));return(b/Math.pow(k,i)).toFixed(1)+" "+s[i]}
function fR(b){return b&&b>1?fB(b)+"/s":"0 B/s"}
function uUI(){var w=S.ra["wan"]||{r:0,t:0};document.getElementById("hR").textContent=fR(w.r);document.getElementById("hT").textContent=fR(w.t);document.getElementById("hC").textContent=S.ct.length||"--";document.getElementById("hD").textContent=S.dh.length||"--";if(S.sy){var u=S.sy.uptime;document.getElementById("hU").textContent=Math.floor(u/86400)+"j "+Math.floor((u%86400)/3600)+"h"}var sh=["wan","br-lan","phy0-ap0","lan2","lan3","lan1","wlan1"],lb={wan:"WAN (Internet)","br-lan":"Bridge LAN","phy0-ap0":"WiFi 2.4GHz",lan2:"LAN 2",lan3:"LAN 3",lan1:"LAN 1",wlan1:"WiFi 5GHz"},mx=1;for(var n in S.ra){var rr=S.ra[n];if((rr.r||0)+(rr.t||0)>mx)mx=(rr.r||0)+(rr.t||0)}var h="";for(var i=0;i<sh.length;i++){var nm=sh[i],d=S.if[nm];if(!d)continue;var rt=S.ra[nm]||{r:0,t:0},up=d.flags?d.flags.up:false,pc=Math.min(100,((rt.r+rt.t)/mx)*100);h+="<div class=\"ic"+(up?"":"\ dn")+"\"><div class=\"icn\"><span class=\"sd"+(up?"":"\ off")+"\"></span>"+(lb[nm]||nm)+"</div><div class=\"ist\"><span class=\"rx\">\u2193 "+fB((d.stats||{}).rx_bytes||0)+"</span><span class=\"tx\">\u2191 "+fB((d.stats||{}).tx_bytes||0)+"</span></div><div class=\"irt\">\u2193 "+fR(rt.r)+" \u2191 "+fR(rt.t)+"</div><div class=\"ib\"><div class=\"ibf\" style=\"width:"+pc+"%\"></div></div></div>"}document.getElementById("iL").innerHTML=h;var dc={},db={};for(var i=0;i<S.ct.length;i++){var c=S.ct[i];dc[c.src]=(dc[c.src]||0)+1;db[c.src]=(db[c.src]||0)+(c.bytes||0)}var dvs=S.dh.map(function(l){return{n:l.hostname||"Inconnu",ip:l.ipaddr,co:dc[l.ipaddr]||0,by:db[l.ipaddr]||0}}).sort(function(a,b){return b.by-a.by});h="";for(var i=0;i<dvs.length;i++){var d=dvs[i];h+="<div class=\"dc"+(d.co>0?"\ ac":"")+"\"><div class=\"dv\">"+d.n+"</div><div class=\"dp\">"+d.ip+"</div><div class=\"dd\"><span class=\"dco\">"+d.co+" conn</span><span class=\"cb\">"+fB(d.by)+"</span></div></div>"}document.getElementById("dL").innerHTML=h;var pt={tcp:0,udp:0},tb=0;for(var i=0;i<S.ct.length;i++){var c=S.ct[i];if(c.layer4==="tcp")pt.tcp++;else if(c.layer4==="udp")pt.udp++;tb+=c.bytes||0}document.getElementById("bP").innerHTML="<div style=\"display:flex;gap:16px;margin-top:4px\"><div><span class=\"sv cb\" style=\"font-size:20px\">"+pt.tcp+"</span><div class=\"ss\">TCP</div></div><div><span class=\"sv cg\" style=\"font-size:20px\">"+pt.udp+"</span><div class=\"ss\">UDP</div></div></div><div class=\"ss\" style=\"margin-top:5px\">Total: "+fB(tb)+"</div>";var pC={},pL={443:"HTTPS",80:"HTTP",53:"DNS",22:"SSH",8883:"MQTT",5228:"Google",123:"NTP",8266:"IoT",9993:"ZeroTier",8802:"Stream"};for(var i=0;i<S.ct.length;i++){var c=S.ct[i];if(c.dport)pC[c.dport]=(pC[c.dport]||0)+(c.bytes||0)}var tp=Object.keys(pC).sort(function(a,b){return pC[b]-pC[a]}).slice(0,5);h="<div style=\"margin-top:4px\">";for(var i=0;i<tp.length;i++){var p=tp[i],l=pL[p]||("P"+p),pc2=Math.max(3,pC[p]/(pC[tp[0]]||1)*100);h+="<div style=\"display:flex;align-items:center;gap:6px;margin-bottom:3px;font-size:9px\"><span style=\"width:44px;color:var(--orange)\">"+l+"</span><div style=\"flex:1;height:3px;background:rgba(255,255,255,.03);border-radius:2px;overflow:hidden\"><div style=\"width:"+pc2+"%;height:100%;background:linear-gradient(90deg,var(--orange),#e67e22);border-radius:2px\"></div></div><span style=\"color:var(--muted);width:52px;text-align:right;font-size:8px\">"+fB(pC[p])+"</span></div>"}document.getElementById("bT").innerHTML=h+"</div>";if(S.sy){var m=S.sy.memory,mP=Math.round(((m.total-m.available)/m.total)*100),ld=(S.sy.load[0]/65536).toFixed(2),dP=S.sy.root?Math.round(S.sy.root.used/S.sy.root.total*100):0;document.getElementById("bS").innerHTML="<div style=\"margin-top:3px\"><div style=\"display:flex;justify-content:space-between;font-size:9px;margin-bottom:4px\"><span>CPU Load</span><span class=\"cg\">"+ld+"</span></div><div style=\"display:flex;justify-content:space-between;font-size:9px;margin-bottom:1px\"><span>RAM</span><span class=\""+(mP>80?"cr":"cb")+"\">"+mP+"%</span></div><div style=\"height:5px;background:rgba(255,255,255,.03);border-radius:3px;overflow:hidden;margin-bottom:5px\"><div style=\"width:"+mP+"%;height:100%;background:"+(mP>80?"var(--red)":"var(--blue)")+";border-radius:3px;transition:width .5s\"></div></div><div style=\"display:flex;justify-content:space-between;font-size:9px;margin-bottom:1px\"><span>Stockage</span><span class=\"co\">"+dP+"%</span></div><div style=\"height:5px;background:rgba(255,255,255,.03);border-radius:3px;overflow:hidden\"><div style=\"width:"+dP+"%;height:100%;background:var(--orange);border-radius:3px;transition:width .5s\"></div></div></div>"}var bb=document.getElementById("bB"),mH=1;for(var i=0;i<S.wH.length;i++){var v=S.wH[i].r+S.wH[i].t;if(v>mH)mH=v}h="";for(var i=Math.max(0,S.wH.length-30);i<S.wH.length;i++){var p3=Math.max(3,((S.wH[i].r+S.wH[i].t)/mH)*100);h+="<div class=\"bi\" style=\"height:"+p3+"%;background:rgba(46,204,113,"+(0.15+p3/200)+")\"></div>"}bb.innerHTML=h;document.getElementById("bW").innerHTML="<div style=\"display:flex;gap:16px;margin-top:3px\"><div><span class=\"sv cg\" style=\"font-size:17px\">"+fR(w.r)+"</span><div class=\"ss\">Download</div></div><div><span class=\"sv co\" style=\"font-size:17px\">"+fR(w.t)+"</span><div class=\"ss\">Upload</div></div></div>"}
function initC(){fc=document.getElementById("fc");cx=fc.getContext("2d");rsC();window.addEventListener("resize",rsC)}
function rsC(){var r=fc.parentElement.getBoundingClientRect();fc.width=r.width;fc.height=r.height}
function Pt(path,col,spd){this.pa=path;this.co=col;this.sp=spd;this.pr=Math.random();this.sz=1.5+Math.random()*2.5;this.op=0.3+Math.random()*0.6}
Pt.prototype.up=function(){this.pr+=this.sp;if(this.pr>1)this.pr-=1};
Pt.prototype.ps=function(){var n=this.pa.length-1,idx=this.pr*n,i=Math.floor(idx),t=idx-i,a=this.pa[Math.min(i,n)],b=this.pa[Math.min(i+1,n)];return{x:a.x+(b.x-a.x)*t,y:a.y+(b.y-a.y)*t}};
Pt.prototype.dr=function(c){var p=this.ps();c.globalAlpha=this.op;c.beginPath();c.arc(p.x,p.y,this.sz,0,Math.PI*2);c.fillStyle=this.co;c.fill();var g=c.createRadialGradient(p.x,p.y,0,p.x,p.y,this.sz*5);g.addColorStop(0,this.co);g.addColorStop(1,"transparent");c.fillStyle=g;c.globalAlpha=this.op*0.12;c.beginPath();c.arc(p.x,p.y,this.sz*5,0,Math.PI*2);c.fill();c.globalAlpha=1};
function bz(x1,y1,x2,y2){var p=[],s=40,c1=x1+(x2-x1)*0.4,c2=x1+(x2-x1)*0.6;for(var i=0;i<=s;i++){var t=i/s,u=1-t;p.push({x:u*u*u*x1+3*u*u*t*c1+3*u*t*t*c2+t*t*t*x2,y:u*u*u*y1+3*u*u*t*y1+3*u*t*t*y2+t*t*t*y2})}return p}
function dLn(p,col,w){cx.beginPath();cx.moveTo(p[0].x,p[0].y);for(var i=1;i<p.length;i++)cx.lineTo(p[i].x,p[i].y);cx.strokeStyle=col;cx.lineWidth=w||1;cx.globalAlpha=0.15;cx.stroke();cx.globalAlpha=1}
function dCi(x,y,r,lb,sub,col,val){var t=Date.now()/1000;cx.beginPath();cx.arc(x,y,r,0,Math.PI*2);cx.strokeStyle=col;cx.lineWidth=2;cx.globalAlpha=0.2;cx.stroke();cx.globalAlpha=1;cx.beginPath();cx.arc(x,y,r-3,0,Math.PI*2);cx.fillStyle="rgba(10,14,26,.93)";cx.fill();cx.beginPath();cx.arc(x,y,r,t%(Math.PI*2),(t%(Math.PI*2))+Math.PI*0.5);cx.strokeStyle=col;cx.lineWidth=3;cx.globalAlpha=0.7;cx.stroke();cx.globalAlpha=1;var gr=cx.createRadialGradient(x,y,r*0.3,x,y,r*1.5);gr.addColorStop(0,"transparent");gr.addColorStop(0.6,col+"0a");gr.addColorStop(1,"transparent");cx.fillStyle=gr;cx.fillRect(x-r*1.5,y-r*1.5,r*3,r*3);cx.textAlign="center";cx.fillStyle="#fff";cx.font="bold 13px sans-serif";cx.fillText(lb,x,y-(sub?4:5));if(sub){cx.fillStyle=col;cx.font="8px sans-serif";cx.fillText(sub,x,y+10)}if(val){cx.fillStyle="#ddd";cx.font="bold 10px sans-serif";cx.fillText(val,x,y+23)}}
function dBx(x,y,w,h,lb,sub,col){cx.fillStyle="rgba(12,20,40,.75)";cx.strokeStyle=col+"40";cx.lineWidth=1;cx.beginPath();var r=5;cx.moveTo(x+r,y);cx.lineTo(x+w-r,y);cx.quadraticCurveTo(x+w,y,x+w,y+r);cx.lineTo(x+w,y+h-r);cx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);cx.lineTo(x+r,y+h);cx.quadraticCurveTo(x,y+h,x,y+h-r);cx.lineTo(x,y+r);cx.quadraticCurveTo(x,y,x+r,y);cx.closePath();cx.fill();cx.stroke();cx.fillStyle="#fff";cx.font="9px sans-serif";cx.textAlign="left";cx.fillText(lb,x+8,y+h/2+1);if(sub){cx.fillStyle=col;cx.font="8px sans-serif";cx.fillText(sub,x+8,y+h/2+12)}}
function dLb(x,y,txt,col){cx.fillStyle=col;cx.font="bold 9px sans-serif";cx.textAlign="left";cx.fillText(txt,x,y);var tw=cx.measureText(txt).width;cx.beginPath();cx.moveTo(x,y+3);cx.lineTo(x+tw+8,y+3);cx.strokeStyle=col;cx.lineWidth=1;cx.globalAlpha=0.2;cx.stroke();cx.globalAlpha=1}
function rF(){var W=fc.width,H=fc.height;cx.clearRect(0,0,W,H);cx.strokeStyle="rgba(46,204,113,.015)";cx.lineWidth=1;for(var x=0;x<W;x+=32){cx.beginPath();cx.moveTo(x,0);cx.lineTo(x,H);cx.stroke()}for(var y=0;y<H;y+=32){cx.beginPath();cx.moveTo(0,y);cx.lineTo(W,y);cx.stroke()}var ifN=["wan","br-lan","phy0-ap0","lan2","lan3"],ifL={wan:"WAN","br-lan":"LAN","phy0-ap0":"WiFi",lan2:"LAN2",lan3:"LAN3"};var ifSp=Math.min(52,(H-90)/ifN.length),ifSY=(H-ifN.length*ifSp)/2;var rX=W*0.28,rY=H*0.42,fwX=W*0.72,fwY=H*0.42;var tD=S.dh.slice(0,Math.min(7,S.dh.length));var dvSp=Math.min(48,(H-70)/Math.max(tD.length,1)),dvSY=(H-tD.length*dvSp)/2;var p1=[],p2=[],p3=[];dLb(16,ifSY-16,"INTERFACES","#2ecc71");for(var i=0;i<ifN.length;i++){var nm=ifN[i],rt=S.ra[nm]||{r:0,t:0},yy=ifSY+i*ifSp;dBx(16,yy-14,115,28,ifL[nm]||nm,fR(rt.r+rt.t),"#2ecc71");var pp=bz(131,yy,rX-42,rY);p1.push(pp);dLn(pp,"#2ecc71",1.2)}var pRF=bz(rX+42,rY,fwX-40,fwY);dLn(pRF,"#f39c12",1.8);var sY1=H*0.16,sY2=H*0.75;var ps1=bz(rX+42,rY,W*0.5-28,sY1);p2.push(ps1);dLn(ps1,"#3498db",1);var ps2=bz(rX+42,rY,W*0.5-24,sY2);p2.push(ps2);dLn(ps2,"#9b59b6",1);dLb(W-150,dvSY-16,"APPAREILS","#9b59b6");for(var i=0;i<tD.length;i++){var yy=dvSY+i*dvSp;dBx(W-148,yy-11,138,22,tD[i].hostname||"?",tD[i].ipaddr,"#9b59b6");var pp=bz(fwX+40,fwY,W-148,yy);p3.push(pp);dLn(pp,"#9b59b6",.8)}if(fr%200===0){pa=[];for(var i=0;i<p1.length;i++)for(var j=0;j<6;j++)pa.push(new Pt(p1[i],"#2ecc71",.002+Math.random()*.006));for(var j=0;j<10;j++)pa.push(new Pt(pRF,"#f39c12",.003+Math.random()*.005));for(var i=0;i<p2.length;i++)for(var j=0;j<4;j++)pa.push(new Pt(p2[i],"#3498db",.002+Math.random()*.005));for(var i=0;i<p3.length;i++)for(var j=0;j<4;j++)pa.push(new Pt(p3[i],"#9b59b6",.002+Math.random()*.005))}for(var i=0;i<pa.length;i++){pa[i].up();pa[i].dr(cx)}dCi(rX,rY,42,"ROUTER","OPENWRT","#2ecc71",fR((S.ra["wan"]||{r:0}).r));dCi(fwX,fwY,38,"FIREWALL",S.ct.length+" flux","#f39c12");dCi(W*0.5,sY1,28,String(S.ct.length),"CONNEXIONS","#3498db");dCi(W*0.5,sY2,26,String(S.dh.length),"APPAREILS","#9b59b6");dCi(W*0.5,H*0.45,20,"\u2713","SECURE","#2ecc71");fr++;requestAnimationFrame(rF)}
function init(){initC();fA();setInterval(fA,3000);rF()}
<\/script>
</body>
</html>
